<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Numerical methods · OceanTurb.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>OceanTurb.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li class="current"><a class="toctext" href>Numerical methods</a><ul class="internal"><li><a class="toctext" href="#Spatial-discretization-1">Spatial discretization</a></li><li class="toplevel"><a class="toctext" href="#Time-stepping-1">Time-stepping</a></li><li><a class="toctext" href="#Explicit-schemes-1">Explicit schemes</a></li><li><a class="toctext" href="#Implicit-explicit-time-stepping-1">Implicit-explicit time-stepping</a></li></ul></li><li><span class="toctext">Boundary layer models</span><ul><li><a class="toctext" href="../models/basics/">Primer on boundary layer modeling</a></li><li><a class="toctext" href="../models/kpp/">The K-Profile-Parameterization (KPP)</a></li><li><a class="toctext" href="../models/pacanowskiphilander/">Pacanowski-Philander</a></li></ul></li><li><span class="toctext">DocStrings</span><ul><li><a class="toctext" href="../man/types/">Private types</a></li><li><a class="toctext" href="../man/functions/">Functions</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Numerical methods</a></li></ul><a class="edit-page" href="https://github.com/glwagner/OceanTurb.jl/blob/master/docs/src/numerics.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Numerical methods</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Numerical-methods-1" href="#Numerical-methods-1">Numerical methods</a></h1><div>\[\newcommand{\c}{\, ,}
\newcommand{\p}{\, .}
\newcommand{\d}{\partial}

\newcommand{\r}[1]{\mathrm{#1}}

\newcommand{\ee}{\mathrm{e}}

\newcommand{\beq}{\begin{equation}}
\newcommand{\eeq}{\end{equation}}

\newcommand{\beqs}{\begin{gather}}
\newcommand{\eeqs}{\end{gather}}\]</div><h2><a class="nav-anchor" id="Spatial-discretization-1" href="#Spatial-discretization-1">Spatial discretization</a></h2><p><code>OceanTurb.jl</code> uses a one-dimensional finite-volume method to discretize momentum, temperature, salinity, and other variables.</p><p>An ASCII-art respresentation of an example grid with <code>N=3</code> is</p><pre><code class="language-text"> ▲ z
 |
         i=4           *         
                j=4   ===  Top   ▲              
         i=3           *         | Δf (i=3)
                j=3   ---        ▼
         i=2           *             ▲            
                j=2   ---            | Δc (j=2)
         i=1           *             ▼  
                j=1   ===  Bottom
         i=0           *           </code></pre><p>where the double lines indicate the top and bottom of the domain, the single lines indicate &quot;face&quot; boundaries, the <code>i</code>&#39;s index cell centers (nodes) and <code>j</code>&#39;s index the <span>$z$</span>-location of cell interfaces (faces). Horizontal momentum and tracer variables are located at cell centers, while fluxes of these quantities (and vertical-velocity-like variables when present) are located at cell faces.</p><h3><a class="nav-anchor" id="Derivatives-and-diffusive-fluxes-1" href="#Derivatives-and-diffusive-fluxes-1">Derivatives and diffusive fluxes</a></h3><p>The derivative of a quantity <span>$\phi$</span> at face <span>$i$</span> is</p><div>\[\beq
\left( \d_z \phi \right )_i = \frac{\phi_i - \phi_{i-1}}{\Delta c_i} \c
\eeq\]</div><p>where <span>$\phi_i$</span> denotes the value of <span>$\phi$</span> at cell <span>$i$</span>, and <span>$\Delta c_i = z_{c, i} - z_{c, i-1}$</span> is the vertical separation between node <span>$i$</span> and cell point <span>$i-1$</span>.</p><p>With diffusivity given on cell interfaces, the diffusive flux at face <span>$i$</span> is just <span>$K_i \left ( \d_z \phi \right )_i$</span>. The (negative of the) divergence of the diffusive flux at node <span>$i$</span> is therefore</p><div>\[\newcommand{\Kdz}[1]{K_{#1} \left ( \d_z \phi \right )_{#1} }
\begin{align}
\left ( \d_z K \d_z \phi \right )_i &amp;= \frac{ \Kdz{i+1} - \Kdz{i} }{\Delta f_i} \c \\
&amp;= \frac{
          \tfrac{K_{i+1}}{\Delta c_{i+1}} \phi_{i+1}
        - \left ( \tfrac{K_{i+1}}{\Delta c_{i+1}} + \tfrac{K_i}{\Delta c_i} \right ) \phi_i
         + \tfrac{K_i}{\Delta c_i} \phi_{i-1}}{\Delta f_i} \p
\end{align}\]</div><p>In the top cell where <span>$i=N$</span>, the diffusive flux is</p><div>\[\begin{align}
\left ( \d_z K \d_z \phi \right )_N &amp;= \frac{ - F_{\mathrm{top}} - K_N \left ( \d_z \phi \right )_N}{\Delta f_N} \c \\
&amp;= -\frac{F_{\mathrm{top}}}{\Delta f_N} - \frac{K_N \phi_N - K_N \phi_{N-1}}{\Delta f_N \Delta c_N} \p
\end{align}\]</div><p>In the bottom cell where <span>$i=1$</span>, on the other hand, the diffusive flux is</p><div>\[\begin{align}
\left ( \d_z K \d_z \phi \right )_1 &amp;= \frac{  K_2 \left ( \d_z \phi \right )_2 + F_{\mathrm{bottom}}}{\Delta f_1} \c \\
&amp;= \frac{F_{\mathrm{bottom}}}{\Delta f_1} + \frac{K_2 \phi_2 - K_2 \phi_1}{\Delta f_1 \Delta c_2}
\end{align}\]</div><h1><a class="nav-anchor" id="Time-stepping-1" href="#Time-stepping-1">Time-stepping</a></h1><p>To integrate ocean surface boundary layer models forward in time, we implement various explicit and implicit-explicit time-stepping schemes.</p><h2><a class="nav-anchor" id="Explicit-schemes-1" href="#Explicit-schemes-1">Explicit schemes</a></h2><p>Our explicit time-stepping schemes integrate partial differential equations of the form</p><div>\[\beq
\d_t \Phi = R(\Phi) \c
\label{explicitform}
\eeq\]</div><p>where <span>$\Phi$</span> is a variable like velocity, temperature, or salinity and <span>$R$</span> is an arbitrary function representing any number of processes, including turbulent diffusion and internal forcing.</p><h2><a class="nav-anchor" id="Implicit-explicit-time-stepping-1" href="#Implicit-explicit-time-stepping-1">Implicit-explicit time-stepping</a></h2><p>Our mixed implicit-explicit time-stepping schemes integrate partial differential equations of the form</p><div>\[\beq \label{implicitdiffusion}
\d_t \Phi - \d_z K \d_z \phi = R(\Phi) \c
\eeq\]</div><p>where <span>$K$</span> is a diffusivity that,  in general, depends on the model state and thus the time-step. These implicit-explicit schemes treat the diffusive term on the left of \eqref{implicitdiffusion} implicitly.</p><h3><a class="nav-anchor" id="Forward-Euler-method-1" href="#Forward-Euler-method-1">Forward Euler method</a></h3><p>The explicit forward Euler time integration scheme uses the temporal discretization \eqref{explicitform}:</p><div>\[\beq
\Phi^{n+1} = \Phi^{n} + \Delta t \, R \left ( \Phi^n \right )
\eeq\]</div><p>where the superscripts <span>$n$</span> and <span>$n+1$</span> denote the solution at time-step <span>$n$</span> and <span>$n+1$</span>, respectively.</p><h3><a class="nav-anchor" id="Backward-Euler-method-1" href="#Backward-Euler-method-1">Backward Euler method</a></h3><p>The backward Euler method uses the temporal discretization</p><div>\[\beq
\Phi^{n+1} - \Delta t \left ( \d_z K^n \d_z \right ) \Phi^{n+1} = \Phi^n + \Delta t R(\Phi^n)
\eeq\]</div><p>The <span>$z$</span>-derivatives in the diffusive term generate a matrix problem to be solved for <span>$\Phi^{n+1}$</span>:</p><div>\[\beq
L_{ij} \Phi^{n+1}_j = \left [ \Phi^n + \Delta t R \left ( \Phi^n \right ) \right ]_i
\eeq\]</div><p>where <span>$L_{ij}$</span> is a matrix, and the subscripts <span>$i$</span> or <span>$j$</span> denote grid points <span>$i$</span> or <span>$j$</span>. Note that the diffusive operator that contributes to <span>$L_{ij}$</span> does not include fluxes across boundary faces; fluxes through boundary faces due either to Dirichlet (Value) boundary conditions or non-zero fluxes must be included in <span>$R \left ( \Phi \right )$</span>. For the diffusive problems considered by our backward Euler solver, <span>$L_{ij}$</span> has the form</p><div>\[\beq
L_{ij} = \left [ \begin{matrix}
1 + \Delta t \tfrac{K^n_2}{\Delta f_1 \Delta c_2}
  &amp; -\Delta t \tfrac{K^n_2}{\Delta f_1 \Delta c_2} &amp; \cdot &amp; \cdot &amp; \cdot &amp; \cdot &amp; \cdot \\
- \Delta t \tfrac{K^n_1}{\Delta f_1 \Delta c_1}
  &amp; 1 + \tfrac{\Delta t}{\Delta f_1} \left (\tfrac{K^n_1}{\Delta c_1} + \tfrac{K^n_2}{\Delta f_1 \Delta c_2} \right )
    &amp; -\Delta t \tfrac{K^n_2}{\Delta c_2} &amp; \cdot &amp; \cdot &amp; \cdot &amp; \cdot \\
\cdot &amp; \ddots &amp; \ddots &amp; \ddots &amp; \cdot &amp; \cdot &amp; \cdot \\
\cdot &amp; \cdot
  &amp; - \Delta t \tfrac{K_i}{\Delta c_i \Delta f_i}
  &amp; 1 - \tfrac{\Delta t}{\Delta f_i} \left ( \tfrac{K_{i+1}}{\Delta c_{i+1}} + \tfrac{K_i}{\Delta c_i} \right )
  &amp; - \Delta t \tfrac{K_{i+1}}{\Delta c_{i+1} \Delta f_{i+1}} &amp; \cdot &amp; \cdot \\
\cdot &amp; \cdot &amp; \cdot &amp; \ddots &amp; \ddots &amp; \ddots &amp; \cdot \\
\cdot &amp; \cdot &amp; \cdot &amp; \cdot &amp; \cdot &amp; - \Delta t \tfrac{K^n_N}{\Delta c_N \Delta f_N}
  &amp; 1 + \Delta t \tfrac{K^n_N}{\Delta c_N \Delta f_N}
\end{matrix} \right ]
\eeq\]</div><footer><hr/><a class="previous" href="../"><span class="direction">Previous</span><span class="title">Home</span></a><a class="next" href="../models/basics/"><span class="direction">Next</span><span class="title">Primer on boundary layer modeling</span></a></footer></article></body></html>
